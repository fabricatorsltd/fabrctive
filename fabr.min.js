class FabrCore{fetchContent(sourceUrl){return fetch(sourceUrl).then((response)=>response.text()).then((html)=>{const parser=new DOMParser();const doc=parser.parseFromString(html,"text/html");const sourceElement=doc.querySelector("html");return sourceElement.innerHTML;}).catch((error)=>{console.error("Error:",error);});}
fetchJSON(sourceUrl){return fetch(sourceUrl).then((response)=>{if(!response.ok){throw new Error("Network response was not OK");}
const contentType=response.headers.get("content-type");if(!contentType||!contentType.includes("application/json")){throw new TypeError("Expected JSON response");}
return response.json();}).then((data)=>{if(!Array.isArray(data)||!data.every((item)=>typeof item==="object")){throw new TypeError("Invalid JSON data");}
return data;}).catch((error)=>{console.error("Error:",error);});}
renderContent(html,container){container.innerHTML=html;const scripts=container.querySelectorAll("script");scripts.forEach((script)=>{if(script.innerText){eval(script.innerText);}else{fetch(script.src).then((response)=>{response.text().then((r)=>{eval(r);});});}});const title=container.querySelector("title");if(title){document.title=title.innerText;}}
renderUrl(url,container){this.fetchContent(url).then((html)=>{return this.renderContent(html,container);}).catch((error)=>console.error("Error:",error));}}
class FabrHelper{constructor(){this.helperUID=Math.random().toString(36).substr(2,9);this.helperName="Generic";this.component=null;}
init(component){this.component=component;}}
class FabrHelperAnimate extends FabrHelper{constructor(){super();this.helperName="Animate";}
animate(element,animation,duration=400){switch(animation){case"fadeIn":this.fadeIn(element,duration);break;case"fadeOut":this.fadeOut(element,duration);break;case"slideUp":this.slideUp(element,duration);break;case"slideDown":this.slideDown(element,duration);break;case"slideLeft":this.slideLeft(element,duration);break;case"slideRight":this.slideRight(element,duration);break;default:break;}}
fade(element,duration,from,to,display,remove=false){element.style.opacity=from;element.style.display=display;let start=null;const step=(timestamp)=>{if(!start)start=timestamp;const progress=timestamp-start;const opacity=from+(to-from)*(progress/duration);element.style.opacity=opacity;if(progress<duration){window.requestAnimationFrame(step);}else{element.style.opacity=to;if(to===0){element.style.display="none";if(remove){element.remove();}}}};window.requestAnimationFrame(step);}
fadeIn(element,duration=400){this.fade(element,duration,0,1,"block");}
fadeOut(element,remove=false,duration=400){this.fade(element,duration,1,0,"block",remove);}
slide(element,duration,from,to,display,remove=false){element.style.transform=`translateX(${from}%)`;element.style.display=display;let start=null;const step=(timestamp)=>{if(!start)start=timestamp;const progress=timestamp-start;const translate=from+(to-from)*(progress/duration);element.style.transform=`translateX(${translate}%)`;if(progress<duration){window.requestAnimationFrame(step);}else{element.style.transform=`translateX(${to}%)`;if(to===0){element.style.display="block";if(remove){element.remove();}}}};window.requestAnimationFrame(step);}
slideUp(element,duration=400){this.slide(element,duration,0,-100,"block");}
slideDown(element,duration=400){this.slide(element,duration,-100,0,"block");}
slideLeft(element,duration=400){this.slide(element,duration,0,-100,"block");}
slideRight(element,duration=400){this.slide(element,duration,-100,0,"block");}}
class FabrHelperIcon extends FabrHelper{constructor(){super();this.helperName="Icon";this.iconsLibrary="";this.iconDOMStructure=null;}
setIconsLibraryFontAwesome(){this.iconsLibrary="fontawesome";this.iconDOMStructure=document.createElement("i");this.iconDOMStructure.classList.add("fas","fa-{{icon}}");}
setIconsLibraryMaterial(){this.iconsLibrary="material";this.iconDOMStructure=document.createElement("i");this.iconDOMStructure.classList.add("material-icons");this.iconDOMStructure.innerHTML="{{icon}}";}
setIconsLibraryBootstrap(){this.iconsLibrary="bootstrap";this.iconDOMStructure=document.createElement("i");this.iconDOMStructure.classList.add("bi","bi-{{icon}}");}
new(icon){if(this.iconDOMStructure===null){this.setIconsLibraryMaterial();}
const iconElement=this.iconDOMStructure.cloneNode(true);iconElement.previousIcon="{{icon}}";iconElement.changeIcon=(icon)=>{iconElement.innerHTML=iconElement.innerHTML.replace(iconElement.previousIcon,icon);iconElement.previousIcon=icon;};iconElement.changeIcon(icon);return iconElement;}}
class FabrHelperLocalStorage extends FabrHelper{constructor(){super();this.helperName="LocalStorage";}
setItem(key,value){try{localStorage.setItem(key,JSON.stringify(value));}catch(e){console.error("Failed to save data to Local Storage: ",e);}}
getItem(key){try{const item=localStorage.getItem(key);if(item){return JSON.parse(item);}
return null;}catch(e){console.error("Failed to retrieve data from Local Storage: ",e);return null;}}
removeItem(key){try{localStorage.removeItem(key);}catch(e){console.error("Failed to remove data from Local Storage: ",e);}}
initComponentStorage(){this.setItem(this.component.componentUID,{});}
getComponentStorage(){const storage=this.getItem(this.component.componentUID);if(storage===null){this.initComponentStorage();return{};}
return storage;}
setCItem(key,value){const storage=this.getComponentStorage();storage[key]=value;this.setItem(this.component.componentUID,storage);}
getCItem(key){const storage=this.getComponentStorage();return storage[key];}
removeCItem(key){const storage=this.getComponentStorage();delete storage[key];this.setItem(this.component.componentUID,storage);}
clearComponentStorage(){this.removeItem(this.component.componentUID);}}
class FabrHelperSharedMemory extends FabrHelper{constructor(){super();this.helperName="SharedMemory";}
init(component){super.init(component);this.sharedMemory=this.#getSharedMemory();this.restrictedKeys=this.#getRestrictedKeys();}
#getSharedMemory(){if(window.fabrSharedMemory){return window.fabrSharedMemory;}
window.fabrSharedMemory={};return window.fabrSharedMemory;}
#getRestrictedKeys(){if(window.fabrSharedMemoryRestrictedKeys){return window.fabrSharedMemoryRestrictedKeys;}
window.fabrSharedMemoryRestrictedKeys=[];return window.fabrSharedMemoryRestrictedKeys;}
set(key,value,replace=false,restricted=false){if(this.sharedMemory[key]&&!replace){return false;}
if(this.restrictedKeys.includes(key)){return false;}
if(restricted){this.restrictedKeys.push(key);}
this.sharedMemory[key]=value;return true;}
get(key){if(this.sharedMemory[key]){return this.sharedMemory[key];}
return false;}
remove(key){if(this.restrictedKeys.includes(key)){return false;}
if(this.sharedMemory[key]){delete this.sharedMemory[key];return true;}
return false;}}
class FabrHelperToast extends FabrHelper{constructor(){super();this.helperName="Toast";}
showToast(message,type="info",duration=3000,deletable=false){const toast=document.createElement("div");toast.className=`fabr-toast fabr-toast-${type}`;toast.innerHTML=message;document.body.appendChild(toast);if(deletable){toast.addEventListener("click",()=>{toast.remove();});}
if(duration===0){return toast;}
setTimeout(()=>{toast.remove();},duration);}}
class FabrHelperWatcher extends FabrHelper{constructor(){super();this.helperName="Watcher";this.watchers={};}
watch(variable,func){this.watchers[variable]=setInterval(()=>{if(this.watchers[variable]!==variable){this.watchers[variable]=variable;func(variable);}},100);}
unwatch(variable){if(this.watchers[variable]){clearInterval(this.watchers[variable]);delete this.watchers[variable];return true;}
return false;}
unwatchAll(){let result=false;for(let variable of Object.keys(this.watchers)){result=this.unwatch(variable)||result;}
return result;}}
class FabrCoreComponent extends FabrCore{constructor(){super();this.componentUID=Math.random().toString(36).substr(2,9);this.componentName="Generic";this.componentType="generic";this.componentStyleClass="fabr-component";this.selector="";this.eventMap={};this.elements=[];}
init(){this.#initElements();this.#initEventListeners();this.#renderElements();}
get repr(){return`<${this.componentName}:${this.componentUID}>`;}
get reprX(){const color=this.componentType==="test"?"#ff6c6c":"#6c63ff";return[`<${this.componentName}:${this.componentUID}>`,`background:${color};color:white;border-radius:3px;padding:0 3px;font-weight:bold`,];}
#initElements(){if(!this.selector){return;}
this.elements=document.querySelectorAll(this.selector);this.elements.forEach((element)=>{element.classList.add(this.componentStyleClass);});}
#initEventListeners(){if(Object.keys(this.eventMap).length===0){return;}
for(let[event,fn]of Object.entries(this.eventMap)){this.elements.forEach((element)=>{element.addEventListener(event,(e)=>{this[fn](e);});});}}
addInternalEventListener(element,event,fn,reference=null,...args){element.addEventListener(event,(e)=>{if(reference){this[fn](e,reference,...args);}else{this[fn](e,...args);}});}
#renderElements(){if(this.elements.length===0){return;}
this.elements.forEach((element)=>{if(this.render){this.render(element);}});}}
class FabrAnimator extends FabrCoreComponent{constructor(){super();this.componentName="FabrAnimator";this.componentStyleClass="fabr-animator";this.selector="[fabr-animator]";this.eventMap={click:"onAnim",mouseover:"onAnim",mouseout:"onAnim",};this.animations={};this.animateHelper=new FabrHelperAnimate();this.animateHelper.init(this);}
onAnim(event){let element=event.target;const animationType=element.getAttribute("fabr-animator-type");const animationEvent=element.getAttribute("fabr-animator-event");const animationTarget=element.getAttribute("fabr-animator-target");if(animationTarget){const target=document.querySelector(animationTarget);if(target){element=target;}}
if(animationEvent!==event.type){return;}
if(!animationType){return;}
this.animateHelper.animate(element,animationType);}}
class FabrCounter extends FabrCoreComponent{constructor(){super();this.componentName="FabrCounter";this.componentStyleClass="fabr-counter";this.selector="[fabr-counter]";this.eventMap={click:"onClick",};this.counters={};}
onClick(event){event.preventDefault();let target=event.target;const virtualTarget=target.getAttribute("fabr-counter-target");if(target.getAttribute("fabr-counter-target")){target=virtualTarget;}
if(target){const counterId=target.getAttribute("fabr-counter");const counter=this.counters[counterId];if(counter){counter.value++;target.innerText=counter.value;}else{const initialValue=parseInt(target.getAttribute("fabr-counter-initial-value"))||0;this.counters[counterId]={value:initialValue+1};target.innerText=this.counters[counterId].value;}}}}
class FabrForm extends FabrCoreComponent{constructor(){super();this.componentName="FabrForm";this.componentStyleClass="fabr-form";this.selector="[fabr-form]";this.eventMap={submit:"onSubmit",};this.toastHelper=new FabrHelperToast();this.toastHelper.init(this);}
onSubmit(event){event.preventDefault();const formData=new FormData(event.target);const formAction=event.target.action;if(event.target.hasAttribute("fabr-form-response")){const responseUrl=event.target.getAttribute("fabr-form-response");this.#getResponse(responseUrl).then((data)=>{if(data.status===200){if(data.redirect){window.location.href=data.redirect;}else{this.toastHelper.showToast(data.message,"success",3000,true);}}else{this.toastHelper.showToast(data.message,"error",0,true);}}).catch((error)=>console.error("Error:",error));return;}
this.#submitForm(formAction,formData).then((data)=>{if(data.status===200){if(data.redirect){window.location.href=data.redirect;}else{this.toastHelper.showToast(data.message,"success",3000,true);}}else{this.toastHelper.showToast(data.message,"error",0,true);}}).catch((error)=>console.error("Error:",error));}
#getResponse(responseUrl){return fetch(responseUrl).then((response)=>response.json()).then((data)=>{return data;}).catch((error)=>{console.error("Error:",error);});}
#submitForm(formAction,formData){return fetch(formAction,{method:"POST",body:formData,}).then((response)=>response.json()).then((data)=>{return data;}).catch((error)=>{console.error("Error:",error);});}}
class FabrLink extends FabrCoreComponent{constructor(){super();this.componentName="FabrLink";this.componentStyleClass="fabr-link";this.selector="[fabr-link]";this.eventMap={click:"onClick",};}
onClick(event){event.preventDefault();let source="";let target=event.target.closest("[fabr-link]");if(target){source=target.hasAttribute("href")?target.getAttribute("href"):target.getAttribute("fabr-link-target");}
const containerId=target?target.getAttribute("fabr-link-dom"):null;const container=containerId?document.getElementById(containerId):document.body;this.fetchContent(source).then((html)=>{return this.renderContent(html,container);}).then(()=>{if(!containerId){window.history.pushState(null,"",source);}}).catch((error)=>console.error("Error:",error));}
onMouseOver(event){console.log("Mouse Over on:",event.target);}}
class FabrNotebook extends FabrCoreComponent{constructor(){super();this.componentName="FabrNotebook";this.componentStyleClass="fabr-notebook";this.selector="[fabr-notebook]";this.eventMap={};this.animateHelper=new FabrHelperAnimate();this.animateHelper.init(this);}
render(notebook){const tabItems=notebook.querySelectorAll("[fabr-notebook-item]");tabItems.forEach((tabItem)=>{const tabId=tabItem.getAttribute("fabr-notebook-item");const tabContent=notebook.querySelector(`[fabr-notebook-content="${tabId}"]`);tabItem.classList.add("fabr-notebook-item");tabContent.classList.add("fabr-notebook-content");tabContent.style.display="none";this.addInternalEventListener(tabItem,"click","activateTabEvent",null,tabItem,tabContent,notebook);});const firstTabItem=notebook.querySelector("[fabr-notebook-item]");const firstTabItemId=firstTabItem.getAttribute("fabr-notebook-item");const firstTabContent=notebook.querySelector(`[fabr-notebook-content="${firstTabItemId}"]`);firstTabItem.classList.add("active");firstTabContent.style.display="block";}
activateTabEvent(event,tabItem,tabContent,notebook){const tabItems=notebook.querySelectorAll("[fabr-notebook-item]");const tabContents=notebook.querySelectorAll("[fabr-notebook-content]");tabItems.forEach((tabItem)=>{tabItem.classList.remove("active");});tabContents.forEach((tabContent)=>{tabContent.style.display="none";});tabItem.classList.add("active");this.animateHelper.fadeIn(tabContent,500);}}
class FabrSnippet extends FabrCoreComponent{constructor(){super();this.componentName="Snippet";this.componentStyleClass="fabr-has-snippet";this.selector="[fabr-snippet]";this.eventMap={};this.iconHelper=new FabrHelperIcon();this.iconHelper.init(this);this.iconHelper.setIconsLibraryMaterial();this.toastHelper=new FabrHelperToast();this.toastHelper.init(this);}
init(){super.init();this.#render();}
#render(){this.elements.forEach((element)=>{this.#renderSnippet(element);});}
#renderSnippet(element){const originElement=document.querySelector(element.getAttribute("fabr-snippet-from"));const snippet=document.createElement("div");const pre=document.createElement("pre");const code=document.createElement("code");const icon=this.iconHelper.new("content_copy");snippet.classList.add("fabr-snippet");code.classList.add("fabr-snippet-code");pre.classList.add("fabr-snippet-pre");icon.classList.add("fabr-snippet-icon");code.innerText=this.#cleanUpHtml(originElement.innerHTML);this.addInternalEventListener(icon,"click","onIconClick",element);pre.appendChild(code);snippet.appendChild(pre);snippet.appendChild(icon);element.appendChild(snippet);}
#cleanUpHtml(unsafe){let res=unsafe.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">").replace(/"/g,'"').replace(/'/g,"'");return res;}
onIconClick(event,element){const codeElement=element.querySelector(".fabr-snippet-code");const codeSnippet=codeElement.innerText;navigator.clipboard.writeText(codeSnippet).then(()=>{this.toastHelper.showToast("Code snippet copied to clipboard!","info");}).catch((error)=>{this.toastHelper.showToast("Code snippet copied to clipboard!","error");});}}
class FabrTable extends FabrCoreComponent{constructor(){super();this.componentName="Table";this.componentStyleClass="fabr-table";this.selector="[fabr-table]";this.eventMap={};this.iconHelper=new FabrHelperIcon();this.iconHelper.init(this);this.iconHelper.setIconsLibraryMaterial();}
render(table){const wrapper=document.createElement("div");const options=table.getAttribute("fabr-table-options").split("|");wrapper.classList.add("fabr-table-wrapper");table.parentNode.insertBefore(wrapper,table);wrapper.appendChild(table);table.activeElement=wrapper;if(options.includes("search")){this.#renderSearch(table);}
if(options.includes("sort")){this.#renderSort(table);}}
#renderSearch(table){const search=document.createElement("input");search.setAttribute("type","search");search.setAttribute("placeholder","Search...");search.setAttribute("fabr-table-search","");search.classList.add("fabr-table-search");table.activeElement.insertBefore(search,table);this.addInternalEventListener(search,"keyup","onKeyup",table);}
#renderSort(table){const ths=table.querySelectorAll("th");ths.forEach((th)=>{const icon=this.iconHelper.new("unfold_more");th.sortIcon=icon;th.appendChild(icon);this.addInternalEventListener(th,"click","onClick",table);th.setAttribute("fabr-table-sort","");});}
#sortTable(th,table){const isAsc=th.getAttribute("fabr-table-sort")==="asc";const ths=table.querySelectorAll("[fabr-table-sort]");ths.forEach((th)=>{th.sortIcon.changeIcon("unfold_more");th.setAttribute("fabr-table-sort","");});const tbody=table.querySelector("tbody");const rows=tbody.querySelectorAll("tr");const index=th.cellIndex;const sortedRows=Array.from(rows).sort((rowA,rowB)=>{const cellA=rowA.cells[index].textContent;const cellB=rowB.cells[index].textContent;return isAsc?cellA.localeCompare(cellB):cellB.localeCompare(cellA);});th.setAttribute("fabr-table-sort",isAsc?"desc":"asc");th.sortIcon.changeIcon(isAsc?"keyboard_arrow_down":"keyboard_arrow_up");while(tbody.firstChild){tbody.removeChild(tbody.firstChild);}
tbody.append(...sortedRows);}
#searchTable(input,table){const value=input.value.toLowerCase();const rows=table.querySelectorAll("tbody tr");rows.forEach((row)=>{const text=row.textContent.toLowerCase();if(text.includes(value)){row.style.display="";}else{row.style.display="none";}});}
onClick(event,table){const target=event.target.closest("[fabr-table-sort]");if(target){this.#sortTable(target,table);}}
onKeyup(event,table){const target=event.target.closest("[fabr-table-search]");if(target){this.#searchTable(target,table);}}}
class FabrTooltip extends FabrCoreComponent{constructor(){super();this.componentName="FabrTooltip";this.componentStyleClass="fabr-has-tooltip";this.selector="[fabr-tooltip]";this.eventMap={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",};this.animateHelper=new FabrHelperAnimate();this.animateHelper.init(this);}
onMouseEnter(event){const target=event.target.closest("[fabr-tooltip]");if(target){const tooltipId=target.getAttribute("fabr-tooltip");const tooltip=document.createElement("div");tooltip.setAttribute("id",tooltipId);tooltip.setAttribute("class","fabr-tooltip");tooltip.innerText=target.getAttribute("fabr-tooltip-text");const targetRect=target.getBoundingClientRect();const tooltipRect=tooltip.getBoundingClientRect();tooltip.style.position="fixed";tooltip.style.top=`${targetRect.top-tooltipRect.height-30}px`;tooltip.style.left=`${targetRect.left-tooltipRect.width/2}px`;document.body.appendChild(tooltip);this.animateHelper.fadeIn(tooltip);}}
onMouseLeave(event){const tooltips=document.querySelectorAll(".fabr-tooltip");tooltips.forEach((tooltip)=>{this.animateHelper.fadeOut(tooltip,true);});}}
class FabrList extends FabrCoreComponent{constructor(){super();this.componentName="FabrList";this.componentStyleClass="fabr-list";this.selector="[fabr-list]";this.eventMap={};}
newList(listName,listItems){const list=document.querySelector(`[fabr-list-name="${listName}"]`);if(!list){}
listItems.forEach((listItem)=>{const item=document.createElement("li");item.classList.add("fabr-list-item");item.innerHTML=listItem;list.appendChild(item);});}
newListFromTemplate(listName,listItems,template){const list=document.querySelector(`[fabr-list-name="${listName}"]`);if(!list){}
listItems.forEach((listItem)=>{let item=template;for(const key in listItem){item=item.replace(`{{${key}}}`,listItem[key]);if(item.includes("{{value}}")){item=item.replace("{{value}}",listItem[key]);}}
const li=document.createElement("li");li.classList.add("fabr-list-item");li.innerHTML=item;list.appendChild(li);});}}
class Fabr extends FabrCore{constructor(){super();console.log("%cFabr initializing...","color: #00f");this.components={form:new FabrForm(),link:new FabrLink(),list:new FabrList(),counter:new FabrCounter(),tooltip:new FabrTooltip(),notebook:new FabrNotebook(),table:new FabrTable(),animator:new FabrAnimator(),snippet:new FabrSnippet(),};this.init();console.log("%cFabr initialized","color: #00f");}
init(){this.initComponents();}
initComponents(){for(const cName in this.components){this.components[cName].init();}}
getComponent(cName){return this.components[cName];}
getComponents(){return this.components;}}
fabr=new Fabr();